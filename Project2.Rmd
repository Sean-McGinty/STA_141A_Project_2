---
title: "Project 2 Description"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    collapsed: no
    df_print: paged
    number_sections: yes
    theme: paper
    toc: yes
    toc_depth: 5
    toc_float: yes
  html_notebook:
    toc: yes
    toc_depth: 5
editor_options: 
  chunk_output_type: inline
---

## Overview

This document contains instructions on Project 2 for STA 141A in Winter 2021. This document is made with `R markdown`. The `rmd` file to generate this document is available on the course website. 

# Background



## WHO COVID-19 data

We will do an EDA for the WHO COVID-19 data. You can take a look at the [weekly WHO COVID-19 update](https://www.who.int/emergencies/diseases/novel-coronavirus-2019/situation-reports) for reference.


```{r}
library(tidyverse)
library(readxl)
library(data.table)
library(cowplot)
library(kableExtra)
```

```{r}
covidmobility <- read_csv("~/Downloads/Global_Mobility_Report.csv") %>% filter(is.na(sub_region_1)) %>% mutate(Date_reported = as.Date(date), Country_code = country_region_code) %>% select(-c("sub_region_1",
"sub_region_2",
"metro_area",
"iso_3166_2_code",
"census_fips_code"))




covidWHO <- read_csv("https://covid19.who.int/WHO-COVID-19-global-data.csv") %>%  mutate(Date_reported = as.Date(Date_reported))

world_pop = read_csv("~/Downloads/csvData.csv") %>% mutate(Country = name)
```
```{r}
covidmobility%>% filter(country_region == "China")
```

```{r}
covidmobility
covidWHO %>% filter(Country == "China")
```


```{r}
cases_by_country = covidWHO %>%  mutate(Year = substr(Date_reported,1,4),
                                 Month = substr(Date_reported,6,7))  %>% 
  na.omit() %>%
  group_by(Country_code,Country) %>% 
  summarise(
        Country_code = unique(Country_code),
           Country = unique(Country),
           WHO_region = unique(WHO_region),
           Cumulative_cases = max(Cumulative_cases),
           New_deaths = sum(New_deaths),
           Cumulative_deaths = max(Cumulative_deaths) ) 
```

```{r}
covid_data = inner_join(covidmobility,covidWHO,by = c("Country_code","Date_reported")) %>% 
  select(c(
           "Country_code",
           "Country",
           "Date_reported",
           "retail_and_recreation_percent_change_from_baseline",   
           "grocery_and_pharmacy_percent_change_from_baseline",
           "parks_percent_change_from_baseline",
           "transit_stations_percent_change_from_baseline",  
           "workplaces_percent_change_from_baseline",
           "residential_percent_change_from_baseline",
           "WHO_region",
           "New_cases",
           "Cumulative_cases",
           "New_deaths",
           "Cumulative_deaths")) %>%
  mutate(Year = substr(Date_reported,1,4),
         Month = substr(Date_reported,6,7)) 


```


```{r}
covid_month_data_20 = covid_data %>% 
  na.omit() %>%
  #filter(Year == "2020") %>%
  group_by(Country_code,Country,Month,Year) %>% 
  summarise(
        Country_code = unique(Country_code),
           Country = unique(Country),
           retail_and_recreation_percent_change_from_baseline = mean(retail_and_recreation_percent_change_from_baseline),   
           grocery_and_pharmacy_percent_change_from_baseline =mean(grocery_and_pharmacy_percent_change_from_baseline) ,
           parks_percent_change_from_baseline = mean(parks_percent_change_from_baseline),
           transit_stations_percent_change_from_baseline = mean(transit_stations_percent_change_from_baseline),  
           workplaces_percent_change_from_baseline = mean(workplaces_percent_change_from_baseline),
           residential_percent_change_from_baseline = mean(residential_percent_change_from_baseline),
           WHO_region = unique(WHO_region),
           New_cases = sum(New_cases),
           Cumulative_cases = max(Cumulative_cases),
           New_deaths = sum(New_deaths),
           Cumulative_deaths = max(Cumulative_deaths) ) 
```
```{r}
#covid_data %>% filter(Month %in% c("01","02","03"), Country == "United Arab Emirates",Year == "2020") %>% select(Date_reported,New_cases,Cumulative_cases,New_deaths,Cumulative_deaths)
```

```{r}
country_data = covid_data %>% group_by(Country) %>% na.omit() %>% summarise(Number_Cases = max(Cumulative_cases),
            Number_Deaths = max(Cumulative_deaths),
            case_mortality_rate = Number_Deaths/Number_Cases,
            Retail_Rec_change = mean(retail_and_recreation_percent_change_from_baseline),
            Grocery_Pharm_change = mean(grocery_and_pharmacy_percent_change_from_baseline),
            Parks_change = mean(parks_percent_change_from_baseline),
            Transit_Stations_change = mean(transit_stations_percent_change_from_baseline),
            Work_change = mean(workplaces_percent_change_from_baseline),
            Resid_change = mean(residential_percent_change_from_baseline))


country_data = inner_join(country_data, world_pop, by  = "Country" ) %>% 
  mutate(cases_per_capita_2020 = Number_Cases/pop2021,
         deaths_per_capita_2020 = Number_Deaths/pop2021)

```
            Retail_Rec_change 
            Grocery_Pharm_change
            Parks_change 
            Transit_Stations_change 
            Work_change 
            Resid_change 
            
            
            
In order to investigate which of our mobility factors is most significant depending on the response variables of cases per capita, number of deaths per capita, and case mortality, we will construct three regression models. 
```{r}
#cases per capita vs our six factors of Retail and Recreation, Grocery & Pharmacy, Parks, Transit Stations, Workplaces, and Residential Change
model1 = lm(data = country_data, cases_per_capita_2020 ~ Retail_Rec_change +
            Grocery_Pharm_change+
            Parks_change +
            Transit_Stations_change +
            Work_change +
            Resid_change )
anova(model1)
summary(model1)

```


```{r}
#deaths per capita vs our six factors of Retail and Recreation, Grocery & Pharmacy, Parks, Transit Stations, Workplaces, and Residential Change
model2 = lm(data = country_data, deaths_per_capita_2020 ~ Retail_Rec_change +
            Grocery_Pharm_change+
            Parks_change +
            Transit_Stations_change +
            Work_change +
            Resid_change )
anova(model2)
summary(model2)


```



```{r}
#case mortality rate vs our six factors of Retail and Recreation, Grocery & Pharmacy, Parks, Transit Stations, Workplaces, and Residential Change
model3 = lm(data = country_data, case_mortality_rate ~ Retail_Rec_change +
            Grocery_Pharm_change+
            Parks_change +
            Transit_Stations_change +
            Work_change +
            Resid_change )
anova(model3)
summary(model3)


```
This data set is maintained by WHO and updated constantly. The first task for you is to understand this data set, e.g., the meaning of the variables and their values. To this end, you can make use of your preferred search engine, or read the documentation for this data set. 

In this project, you are a team of conscientious statisticians, who wish to help the general public understand the ongoing pandemic. 



## Suggested outline 

The following list provides one potential structure of the data analysis report. As this is the final project, the following suggestions are intended to provide one viable route for your project while leaving you as much freedom as possible. 

***

0. Before writing your analysis report, you may want to explore this data set and read about the coronavirus to generate the hypothesis or question to be answered in this report, i.e., the question(s) of interest. You can be creative on this question so long as it meets three conditions.

    a. This question might be meaningful in real-world. 
    b. A method discussed in this course is employed in solving this question. 
    c. This question does not ask for causality.  

***


1. Introduce the dataset and the questions of interest. 

Our primary question of interest is whether the amount of mobility (or mobility index) affects the death count per capita, case mortality rate, and number of cases per capita on a global/country scale. 

2. Review the background of the coronavirus. 

3. Explore this dataset and generate summary statistics that you find informative, and explain your findings. <span style="color:red"> The summary statistics should include at least time, number of cases, number of death, case-mortality rate.</span>

4.  Propose an appropriate model to answer the questions of interest. 
      a. Explain your notations. 
      b. State assumptions for your model. 
      c. Explain why your model is appropriate for this task. 


5.  Fit the proposed model in (4) and explain your results. 

6.  Conduct model diagnostics and/or sensitivity analysis. 

7. Conclude your analysis with a discussion of your findings and caveats of your approach. 


***

# Abstract

***

# Introduction

***

# Background 

***

# Descriptive analysis 

***

# Inferential analysis

***

# Sensitivity analysis 

***

# Discussion 

***

# Acknowledgement {-}


Zhang, Zitong

***

# Reference {-}


***

# Appendix {-}
```{r, ref.label=knitr::all_labels(),echo=TRUE,eval=FALSE}
```

***

# Session info {-}


